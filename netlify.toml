# Netlify configuration for CatchLotto monorepo
# Main web app deployment with preview deployments

[build]
  # Base directory - Next.js app directory in monorepo
  base = "apps/web"
  # Build command - install dependencies from root and build web app
  command = "cd ../.. && pnpm install && pnpm build:web"
  # Publish directory (Next.js plugin will handle this automatically)
  publish = ".next"

# Environment variables
[build.environment]
  NODE_VERSION = "22"
  PNPM_VERSION = "8.15.0"
  # Next.js environment
  NEXT_TELEMETRY_DISABLED = "1"

# Context-specific settings
# Production deployment
[context.production]
  base = "apps/web"
  command = "cd ../.. && pnpm install && pnpm build:web"
  publish = ".next"
  [context.production.environment]
    NODE_ENV = "production"

# Preview deployments (for PRs and branches)
# These will automatically create preview deployments for pull requests
[context.branch-deploy]
  base = "apps/web"
  command = "cd ../.. && pnpm install && pnpm build:web"
  publish = ".next"
  [context.branch-deploy.environment]
    NODE_ENV = "production"

[context.deploy-preview]
  base = "apps/web"
  command = "cd ../.. && pnpm install && pnpm build:web"
  publish = ".next"
  [context.deploy-preview.environment]
    NODE_ENV = "production"

# Plugin configuration
# Netlify Next.js plugin - automatically handles Next.js deployment
# The plugin will automatically detect Next.js app based on base directory
[[plugins]]
  package = "@netlify/plugin-nextjs"

